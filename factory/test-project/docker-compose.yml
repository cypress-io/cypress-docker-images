version: '3'

services:
  args-defined:
    build:
      dockerfile: argsDefined.Dockerfile
      context: .
      args:
        BASE_FACTORY_IMAGE: cypress/factory:${FACTORY_VERSION}
    command: npm run test
  # Installs node only
  test:
    build:
      context: .
    command: npm run test
  # Installs Node and Chrome
  test-chrome:
    build:
      args:
        CHROME_VERSION: '107.0.5304.121-1'
      context: .
    command: npm run test -- -b chrome
    # Installs Node and Chrome 1.08
  test-chrome-latest:
    build:
      args:
        CHROME_VERSION: '108.0.5359.124-1'
      context: .
    command: npm run test -- -b chrome
  # Installs Node and Firefox
  test-firefox:
    build:
      args:
        FIREFOX_VERSION: '107.0'
      context: .
    command: npm run test -- -b firefox
  # Installs Node and Edge
  test-edge:
    build:
      args:
        EDGE_VERSION: '100.0.1185.29-1'
      context: .
    command: npm run test -- -b edge
  # Doesn't npm install the local cypress version, builds with cypress 10, tests will fail.
  no-npm-install:
    env_file: ../.env
    build:
      args:
        CYPRESS_VERSION: ${CYPRESS_VERSION}
        CHROME_VERSION: ${CHROME_VERSION}
        BASE_FACTORY_IMAGE: cypress/factory:${FACTORY_VERSION}
      dockerfile: noNPMInstall.Dockerfile
      context: .
    command: cypress run -b chrome
  # no-npm-install-webkit:
  #   build:
  #     args:
  #       CYPRESS_VERSION: '12.2.0'
  #       WEBKIT_VERSION: '1.29.0'
  #     dockerfile: noNPMInstall.Dockerfile
  #     context: .
  #   command: cypress run -b webkit
  # Uses factory_included
  included:
    build:
      dockerfile: included.Dockerfile
      context: .
      args:
        BASE_FACTORY_IMAGE: cypress/factory:${FACTORY_VERSION}
    command: cypress run -b chrome
